# Self-Hosted-Malware-Analysis-Lab

Setting up Self Hosted Malware Analysis Lab

<b><h3>Setup:</h3></b>

•	VMware(Virtual Machine)

•	FlareVm (Virtual Environment to detonate and analyze malware safely)

•	REMnux (C2)

 <b><h3>Topology:</h3></b>
<img src="server setup.png" alt="alternative text">


<h1>Zeus Malware Analysis</h1>

<h3>Overview of Tools used for Analysis:</h3>

•	Pestudio

•	VirusTotal

•	Capa

•	Cutter

•	Pocmon

•	floss



<h2><b>Fingerprint</h2></b>

<h3><b>Virus Total:</h3></b>

First I uploaded the file on Virus Total to get a quick insight on the malware to see if its flagged or not.

<img src="virustotal.jpg" alt="alternative text">
 
**Filename**: invoice_2318362983713_823931342io.pdf.exe  

**Hashes:**

<b>MD5</b>:ea039a854d20d7734c5add48f1a51c34
 
<b>SHA1</b>:9615dca4c0e46b8a39de5428af7db060399230b2 

 <b>SHA256</b>:69e966e730557fde8fd84317cdef1ece00a8bb3470c0b58f3231e170168af169  
 
  <b>DNS</b>:correct.com


<h2>•	Static Analysis:</h2>

 <h3>PEstudio and Floss:</h3>
 
I used Pestudio detailed overview of the malware and the strings or api called and potentially artifiacts to help with analysis.

<b><h3>Api:</b></h3>

•	CallWindowProcW

•	UpdateWindow

•	GetCapture

•	IsWindowEnabled

•	GetWindowTextLengthW

•	AllowSetForegroundWindow

•	DeleteCriticalSection

•	SizeofResource

•	GetEnvironmentVariableA

•	GetDriveTypeA

•	GetTickCount

•	GetEnvironmentVariableW

•	GetLogicalDrives

•	LocalFree

•	LocalAlloc

•	VirtualQueryEx

•	LocalUnlock

•	HeapFree

•	GetAsyncKeyState

•	CopyAcceleratorTableA

•	SwapMouseButton

•	VkKeyScanA

•	PathCombineW

•	PathQuoteSpacesA

•	PathRenameExtensionA

•	FindNextFileA

•	CreateFileMappingA

•	GetCompressedFileSizeA

•	WriteFile

•	GetPrivateProfileIntW

•	WinExec

•	GetCurrentThread

•	FreeLibrary

•	GetModuleHandleW

•	GlobalAddAtomA

•	GetClipboardOwner

•	GetClipboardData

•	EnumClipboardFormats

•	DdeQueryNextServer

•	GetConsoleAliasExesLength

•	PathRemoveArgsA

•	StrCmpNIA

•	PathMatchSpecW

•	IsCharSpaceA

•	PathMakeSystemFolderA

•	PathIsRelativeA

•	PathIsSameRootA

•	PathParseIconLocationW

•	PathIsUNCServerA

•	14 (GetAcceptLanguages

•	ChrCmpIW

•	PathAddExtensionW

•	157 (StrCmpIC

•	PathIsRootW

•	29 (IsCharSpace

•	PathIsPrefixA

•	PathRelativePathToW

•	ChrCmpIA

•	GetUserDefaultUILanguage

•	GetOEMCP

•	SetCurrentDirectoryW

•	IsBadReadPtr

•	GetSystemDefaultUILanguage

•	GetSystemDefaultLCID

•	GetProcessDefaultLayout

•	AppendMenuA

•	GetCaretPos

•	GetSysColor

•	DestroyCursor

•	GetScrollInfo

•	FlashWindowEx
•	SetLastErrorEx

•	InflateRect

•	ShowCaret

•	LoadBitmapA

•	DeleteMenu

•	HideCaret



<h3>Strings:</h3>

•	AsksmaceaglyBubuPulsKaifTeasMistPeelGhisPrimChaoLyreroeno

•	KERNEL32.MulDiv

•	BagsSpicDollBikeAzonPoopHamsPyasmap

•	KERNEL32.SetCurrentDirectory

•	BardHolyawe

•	SHLWAPI.SHFreeShared

•	BathEftsDawnvilepughThroCymakohloverMitefuzerat

•	SHLWAPI.PathMakeSystemFolder

•	BemaCadsPodsWavyCedeRadsbrioOustPerefenom

•	USER32.SetDlgItemText

•	KERNEL32.VirtualQuery

•	CameValeWauler

•	USER32.IsIconic

•	CedeSalsshulLimyThroliraValeDonabox

•	USER32.CreateCaret

•	CellrotoCrudUntohighCols

•	KERNEL32.CreateFile

•	DenyLubeDunssawsOresvarut

•	SHLWAPI.PathRemoveFileSpec

•	DragRoutflusCrowPeatmownNewsyaksSerfmare

•	USER32.DestroyIcon

•	Dumpcotsavo

•	USER32.SetDlgItemInt

•	DungBadebankBangGelthoboCocaBozotsksWheyVaryShoghoseNipsCadisi

•	USER32.EndPaint

•	ExitRollWoodGumsgamaSloerevsWussletssinkYearZitiryesHypout

•	USER32.GetClassInfo

•	FociTalcileador

•	KERNEL32.ConvertDefaultLocale

•	GeneAilshe

•	KERNEL32.FindFirstFile

•	GhisGoodHowlCoonCigscateged

•	KERNEL32.GetWindowsDirectory

•	GimpWadsdashHoraYardSeatDeanScanscowRantKeasfib

•	KERNEL32.LCMapString

•	Haesourfe

•	USER32.GetKeyNameText

•	HoggSoonLasstwaeNapeCeilBawlscopdub

•	KERNEL32.SystemTimeToFileTime

•	Icontellnoway

•	SHLWAPI.PathRemoveBlanks

•	ImidslatJokyCombdrubChefBilkSale

•	USER32.GetShellWindow

•	IzararfsFlamWostAirsconsMouefemelallPoretweeSacsOxidMinx

•	SHLWAPI.PathAddExtension

•	JabsNaveFateLariManyLeeksecshiesBawlwoo

•	KERNEL32.CreateIoCompletionPort

•	KatsDoreOmerBetsKoraKeef

•	KERNEL32.GetShortPathName

•	KineChamLows

•	KERNEL32.SetCurrentDirectory

•	LeerMiff

•	KERNEL32.LeaveCriticalSection

•	MaarSectFiscNextMattbamsErasnimstoeaBadshon

•	USER32.GetClassInfo

•	MarkMokeOsesShwaSkegpornlimemim

•	KERNEL32.GetStartupInfo

•	MeanOrrabirogirtWorkGawpSassPirnVinoLotaPledEidefe

•	SHLWAPI.SHLockShared

•	NextLoveOralwanySurfhm

•	KERNEL32.VerSetConditionMask

•	NisiBoyolineJiaoveryObiaowedblamHaetMaulweensky

•	SHLWAPI.PathCanonicalize

•	OastcabskamiKartDumbInksSomsMass

•	KERNEL32.SetCurrentDirectory

•	PeckQuinFillrillsaw

•	KERNEL32.GetThreadPriority

•	RamilimaputtHastJobs

•	KERNEL32.FindNextFile

•	RemsSlaySoreAnoaaxalbuffusesemeuMapsyogaHangLoud

•	SHLWAPI.PathMakePretty

•	RidsFineZingMickMomsdue

•	USER32.GetMonitorInfo

•	SeminerdsoloseenYaginobox

•	SHLWAPI.PathIsLFNFileSpec

•	SiretomsbritGrewIckyNapaLumsBoaren

•	KERNEL32.OpenFileMapping

•	SlabKitsSlayseptPfftjiffSabsdeskOafsNowtMemsKirnKepiMiffDunt

•	KERNEL32.OpenSemaphore

•	SoldKartAgueiliaRushWauldhal

•	SHLWAPI.PathIsUNC

•	SuitplieGunsMaidBaitFeusJiaotodycolyAlbsLuneToyspe

•	USER32.GetProp

•	SungActaKopsMaarposyparefuzedeck

•	SHLWAPI.PathIsDirectory

•	ToeaTailecusGeesSoliCadeSpueEndsPlaykaphall

•	SHLWAPI.PathRemoveArgs

•	Vavsrubepodsjadebrooli

•	USER32.GetUpdateRgn

•	VeerCrawFlateel

•	SHLWAPI.PathParseIconLocation

•	WainMeekPinyWonkpooflaudsir

•	KERNEL32.GetWindowsDirectory

•	WhopTestrangrapsdebsTzarNipaYins

•	KERNEL32.DeleteFile

•	YeukMags

•	KERNEL32.GlobalHandle

•	ZetaBeduPirnhipsjailTingSrisTeleAposhuskNameHoerflagemuwo

•	USER32.LoadIcon


<b><h3>Capa:</h3></b>



To demonstrate the malware's capabilities and correlate these with internal operations, the following functionalities will be illustrated.
<img src="Capa.png" alt="alternative text">

 

<b><h3>Cutter:</h3></b>

To further break down what was going on with the malware I used cutter the image seen below is a grap or map of the malware behaviour and commands or api being called along each box.

 <img src="cutter snap.PNG" alt="alternative text">



<b><h2>•	Dynamic Analysis:</b></h>

<b><h3>Procmon:</h3></b>

Procmon is a process monitoring tool in the instance I used this tool to monitor the behavior of the malware at this stage which is the dynamic analysis of the malware I finally detonated the malware and use the tool to analyze the behavior of the activities the malware was carrying out

<img src="procmonfile2.PNG" alt="alternative text">

<img src="procmonfile.PNG" alt="alternative text">

 



Upon executing the malicious program, it initiated a self-destruct sequence. To monitor its activities, I had previously employed Process Monitor, which confirmed the creation and deletion of files. This suggested a persistence strategy. Further investigation uncovered a file named 'installflashplayer.exe' in a designated directory. This file, sourced from Adobe, raised no alarms on any malware platform, appearing harmless.

<b><h2>Yara (IOC):</b></h2>
Yara is a versatile tool employed for the classification and identification of malware, enabling the creation of rules based on artifacts found during the malware's analysis. This facilitates efficient and accurate identification of similar threats in future encounters.

rule zeus banking malware

{

meta:
	
 descripton = “yara rule for zeus banking malware”

strings:

$dns= “correct.com”

$file_name=”invoice_2318362983713_823931342io.pdf.exe ”

$hash=”69e966e730557fde8fd84317cdef1ece00a8bb3470c0b58f3231e170168af169”

$string_A= “BardHolyawe”

$string_B=” LeerMiff”


condition:

($dns and $file_name or $hash and $string_A or $string_B)



}




<b><h3>Conclusion:</b></h3>

In conclusion, the comprehensive analysis of the **Zeus Banking Malware**  has revealed its complex and multifaceted nature, underscoring the significant threat it poses to [windows Systems]. The technical examination uncovered that the malware employs [Persistence and self-deletion strategies, along with file creation and removal techniques for ensuring persistence, evasion tactics to avoid being detected the malware self deletes after being detonated, The file type has a .pdf at the end to sort like mask the .exe in between to decieve users into thinking its a pdf file] to infect and control its targets effectively, while avoiding detection by conventional security measures.







